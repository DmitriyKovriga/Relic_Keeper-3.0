# План: Редактор аффиксов, тиры, теги, название

## 1. Изменения в ItemAffixSO

- **Добавить поле «название аффикса»** (для детального отображения в тултипе):
  - `string NameKey` — ключ локализации названия (отдельная таблица или общая с AffixesLabels). Локали EN/RU правятся в редакторе.
- **Оставить** `TranslationKey` без смены смысла: используется для отображения **значения** аффикса по шаблону типа `affix_type_stat` (логика формирования пути не трогаем).
- **Убрать** `RequiredLevel` из ассета. Хранить только **тир** (1–5). Уровень выпадения определяется только тиром (захардкоженные диапазоны).
- **Добавить систему тегов:**
  - `List<string> TagIds` (или ссылки на `AffixTagSO`) — теги аффикса для крафта/генерации.
  - Теги имеют локализацию (EN/RU) и правятся в редакторе аффиксов.

---

## 2. Захардкоженные тиры по уровню предмета

- Таблица (в коде, не в ассетах):
  - **Тир 5** (самый слабый): уровни предмета **1–5**
  - **Тир 4**: **5–10**
  - **Тир 3**: **10–15**
  - **Тир 2**: **15–25**
  - **Тир 1** (самый сильный): **25–30**
- В аффиксе хранится только `Tier` (1–5). `RequiredLevel` нигде не хранить и не использовать.
- Генерация: при ролле аффиксов для предмета уровня `itemLevel` в пул попадают только аффиксы, у которых тир допускает этот уровень (например, метод `TierAllowedForLevel(itemLevel, tier)` или аналог).

---

## 3. Генерация аффиксов (ItemGenerator + AffixPoolSO)

- **AffixPoolSO.GetRandomAffixes(count, itemLevel):**
  - Убрать фильтр по `RequiredLevel`.
  - Фильтровать по тиру: брать аффикс только если `itemLevel` попадает в диапазон его тира (по захардкоженной таблице выше).
- **ItemGenerator** — без изменений по сигнатурам: по-прежнему передаёт `itemLevel` в пул; логика «допустим ли аффикс» целиком в пуле/тирах.
- При необходимости вынести маппинг «уровень → допустимые тиры» в статический хелпер (например, в `ItemAffixSO` или отдельный `AffixTierHelper`).

---

## 4. Система тегов для аффиксов

- **Назначение:** крафт и генерация (например, «гарантировать минимум 1 аффикс с тегом “физический урон”»).
- **Первые теги = категории статов:**
  - Взять категории из `StatsDatabaseSO` (или текущую логику `GetStatCategory(StatType)` из AffixGeneratorTool / StatsDatabaseSO).
  - Для каждого стата в аффиксе (`Stats[i].Stat`) автоматически добавлять тег, равный категории этого стата (если такого тега ещё нет в списке тегов аффикса).
- **Хранение тегов:**
  - Вариант A: отдельный ассет `AffixTagSO` (id, ключ локализации названия). Список тегов в проекте — все такие ассеты в папке `Resources/AffixTags` (или аналог).
  - Вариант B: один ассет-база (например, `AffixTagDatabaseSO`) с массивом записей `{ id, nameKey }`. Локали по nameKey в таблице (например, AffixTags_en / AffixTags_ru).
- **В аффиксе:** массив строк `TagIds` (или ссылки на ассеты). При сохранении/редактировании аффикса:
  - автоматически добавлять теги из категорий статов;
  - давать возможность вручную добавлять/удалять теги (в т.ч. удалять авто-теги, если нужно).
- **Локали тегов:** EN и RU, правка в редакторе аффиксов (и при необходимости отдельное окно «редактор тегов»).

---

## 5. Редактор аффиксов (Affix Editor)

- **Меню:** одна кнопка в общем поле Tools, не в выпадашке RPG.
  - Например: `[MenuItem("Tools/Affix Editor")]`.
- **Функции окна:**
  1. **Список аффиксов** — все `ItemAffixSO` в проекте (поиск, фильтр по тиру/тегу/пулу).
  2. **Создать аффикс** — кнопка, создание нового ассета (по умолчанию Tier 5, пустые статы, теги по желанию пустые или авто из статов после добавления).
  3. **Редактировать аффикс** — при выборе в списке справа панель деталей:
     - Системные параметры (UniqueID и т.п.) по умолчанию **скрыты**; опция «показать системные» для отладки.
     - Редактируемые: GroupID, Tier, TranslationKey (или только отображение, если ключ авто), **NameKey**, Stats, **TagIds** (список + добавить/удалить тег).
     - Локали названия аффикса (EN/RU) по NameKey — поля ввода и кнопка «Сохранить в таблицу».
  4. **Удалить аффикс** — кнопка с подтверждением; перед удалением можно показать, в каких пулах он используется.
  5. **«В каких пулах»** — для выбранного аффикса список всех `AffixPoolSO`, в которых он есть (поиск по `pool.Affixes`).
  6. **«Пул в каких предметах»** — для выбранного пула: список предметов (EquipmentItemSO), которые «попадают» в этот пул (по Slot + DefenseType, как в ItemGenerator). Показ только в виде списка имён/ассетов с возможностью перейти к предмету.
  7. **Добавить в пул / Удалить из пула:**
     - Список всех пулов с чекбоксами (или мультиселект). Кнопки «Добавить выбранный аффикс в отмеченные пулы» и «Удалить выбранный аффикс из отмеченных пулов». Работа с текущим выбранным аффиксом.
- **Удобство:** всё в одном окне, без лишних переходов; смена аффикса не сбрасывает скролл/выбор пулов (по аналогии с пожеланием по карусели вкладок).

---

## 6. Редактирование тегов и локалей

- **Теги:**
  - В Affix Editor: для выбранного аффикса список тегов с «+» / «−»; при добавлении — выбор из всех зарегистрированных тегов (из базы/папки ассетов).
  - Отдельное подменю или вкладка «Управление тегами»: создать тег (id + nameKey), удалить тег, редактировать локали (EN/RU) по nameKey. Локали хранить в таблице (например, AffixTags или общая таблица).
- **Название аффикса (NameKey):** в панели редактирования аффикса поля «Name (EN)» / «Name (RU)» и кнопка сохранения в выбранную таблицу локалей (та же, что для AffixesLabels или отдельная для имён).

---

## 7. Перенос кнопки открытия редактора

- Сейчас: пункты под RPG — «Tools/RPG/Generate Affixes...», «Tools/RPG/2. Sync Affix Text...».
- Сделать: **«Tools/Affix Editor»** — отдельный пункт в общем меню Tools (рядом с Stats Editor, Items Editor и т.д.), не внутри выпадашки RPG.
- Генератор и синк можно оставить под RPG или тоже вынести в Tools — по желанию; в плане обязательно только вынести **кнопку открытия редактора аффиксов** в Tools.

---

## 8. Порядок реализации (рекомендуемый)

1. **Данные и тиры**
   - Добавить в `ItemAffixSO`: `NameKey`, убрать `RequiredLevel`, добавить `List<string> TagIds` (или список ссылок на теги).
   - Ввести статический хелпер с маппингом уровень → тир (или тир → диапазон уровней) и метод «допустим ли аффикс по тиру для уровня».
   - Обновить `AffixPoolSO.GetRandomAffixes`: фильтр по тиру вместо RequiredLevel.
   - Обновить `ItemGenerator` при необходимости (если где-то ещё используется RequiredLevel).

2. **Теги**
   - Создать способ хранения тегов (AffixTagSO или AffixTagDatabaseSO) и папку/ассеты.
   - Добавить локализацию тегов (таблица + ключи).
   - В аффиксе: авто-теги из категорий статов при сохранении/применении; ручное добавление/удаление в инспекторе или только в редакторе.

3. **Редактор аффиксов**
   - Окно Affix Editor: список аффиксов, выбор, панель деталей (с скрытыми системными полями).
   - CRUD: создание, редактирование (в т.ч. NameKey и локали EN/RU), удаление с проверкой использования.
   - Блок «В каких пулах» и «Пул в каких предметах».
   - Блок «Добавить в пул / Удалить из пула».
   - Пункт меню `Tools/Affix Editor`.

4. **Редактор тегов и локали**
   - В Affix Editor: секция тегов (список, добавить/удалить, выбор из всех тегов).
   - Управление тегами: создание/удаление тега, редактирование EN/RU для тегов.
   - Сохранение названия аффикса (NameKey) в выбранную таблицу локалей из редактора.

5. **Финал**
   - Убедиться, что нигде не осталось использования RequiredLevel.
   - Проверить генерацию предметов по уровням 1–30 и тирам 1–5.
   - При необходимости обновить AffixGeneratorTool (генерация новых аффиксов без RequiredLevel, с Tier и при желании с тегами).

---

## 9. Краткий чеклист

- [ ] ItemAffixSO: поле NameKey, убрать RequiredLevel, добавить TagIds (или ссылки на теги).
- [ ] Захардкодить тиры: 5→1–5, 4→5–10, 3→10–15, 2→15–25, 1→25–30.
- [ ] AffixPoolSO.GetRandomAffixes — фильтр по тиру вместо уровня.
- [ ] Хранение тегов (ассеты или база) + локали EN/RU.
- [ ] Авто-теги из категорий статов для аффикса; ручное добавление/удаление.
- [ ] Окно Affix Editor: список, создание, редактирование (без системных полей по умолчанию), удаление.
- [ ] В редакторе: «в каких пулах», «пул в каких предметах», добавление/удаление аффикса в пулы.
- [ ] Редактирование названия аффикса (EN/RU) и тегов (EN/RU) в редакторе.
- [ ] Меню: Tools/Affix Editor (не в выпадашке RPG).
- [ ] ItemGenerator и существующие ассеты не ломаются; при необходимости — миграция старых аффиксов (Tier оставить, RequiredLevel выкинуть).

После согласования плана можно приступать к реализации по шагам выше.
