# План тестирования: Character System & Tavern

## 1. Character Editor

### 1.1 Открытие и навигация
- [ ] Tools → Character Editor открывает окно
- [ ] Слева отображается список персонажей
- [ ] Поиск по имени/ID работает
- [ ] Выбор персонажа показывает детали справа

### 1.2 Создание персонажа
- [ ] Кнопка «Create New Character» создаёт новый ассет в Assets/Resources/Heroes/
- [ ] Новый персонаж появляется в списке
- [ ] ID задаётся автоматически (NewCharacter, NewCharacter_1, …)
- [ ] Персонаж добавляется в CharacterDatabase (если база найдена)

### 1.3 Редактирование
- [ ] ID, NameKey, DescriptionKey, Fallback, Portrait редактируются
- [ ] Starting Stats — добавление/удаление StatConfig
- [ ] Passive Tree — выбор дерева из ObjectField
- [ ] Кнопка «Open Passive Tree Editor» открывает редактор с выбранным деревом

### 1.4 Локализация
- [ ] Секция Localization отображает ключи character.{id}.name / .description
- [ ] Поля EN/RU редактируются
- [ ] «Save Localization» записывает в MenuLabels (en/ru)

### 1.5 Tree Modifier Totals
- [ ] При выбранном дереве отображаются суммы по StatType и StatModType
- [ ] Формат: StatType → Flat/PercentAdd/PercentMult: value

---

## 2. Сохранение и загрузка (v2)

### 2.1 Сохранение
- [ ] K — сохраняет игру
- [ ] В сейве: ActiveCharacterID, Characters (список CharacterSaveData), Stash
- [ ] У каждого персонажа: CharacterClassID, Health, Mana, Level, XP, SkillPoints, Inventory, AllocatedPassiveNodes

### 2.2 Загрузка
- [ ] L — загружает игру
- [ ] Активный персонаж загружается в PlayerStats, Inventory, PassiveTree
- [ ] Склад загружается отдельно (общий)

### 2.3 Миграция v1 → v2
- [ ] Старый сейв (v1) загружается без ошибок
- [ ] Данные конвертируются в новый формат
- [ ] В логе: «Save migrated: 1 -> 2»

---

## 3. Character Swap

### 3.1 Смена в рантайме
- [ ] Открыть Tavern (H)
- [ ] В хостеле есть персонажи (если наняли ранее)
- [ ] Кнопка «Swap to Active» — текущий уходит в хостел, выбранный становится активным
- [ ] Инвентарь и статы меняются на данные выбранного персонажа
- [ ] Дерево пассивок переключается

### 3.2 Сохранение при свопе
- [ ] После свопа нажать K (Save)
- [ ] Перезапустить игру, загрузить (L)
- [ ] Активен тот персонаж, на которого свопнулись

---

## 4. Tavern / Hire

### 4.1 Окно трактира
- [ ] H — открывает/закрывает окно
- [ ] Отображаются 3 случайных героя для найма
- [ ] У каждого: портрет, имя, описание, статы, кнопки «View Tree» и «Hire»

### 4.2 Найм
- [ ] «Hire» — добавляет персонажа в партию
- [ ] Если это первый персонаж — он становится активным
- [ ] «Reroll Heroes» — меняет тройку на другую случайную

### 4.3 View Tree
- [ ] «View Tree» — в консоль выводятся суммы модификаторов дерева (для осмотра)

### 4.4 Хостел
- [ ] Секция «Hostel» показывает неактивных персонажей
- [ ] «Swap to Active» — смена активного на персонажа из хостела

### 4.5 Новая игра
- [ ] Удалить сейв (Delete) или запустить без сейва
- [ ] При старте открывается окно найма (если Tavern UI For New Game задан в GameSaveManager)
- [ ] Кнопка «Close» скрыта — нужно нанять героя
- [ ] После найма окно закрывается, игра начинается с выбранным героем

---

## 5. Интеграция

### 5.1 Персонаж + инвентарь
- [ ] Экипировка и рюкзак сохраняются с персонажем
- [ ] При свопе инвентарь меняется на инвентарь выбранного персонажа

### 5.2 Склад
- [ ] Склад общий — при свопе содержимое не меняется
- [ ] Сохранение/загрузка склада не зависит от активного персонажа

### 5.3 Новый персонаж в редакторе
- [ ] Создать персонажа в Character Editor
- [ ] Запустить игру, открыть Tavern
- [ ] Новый персонаж может появиться в выборе из трёх (если он в базе)
- [ ] Нанять — персонаж добавляется в партию и доступен для активации

---

## 6. Регрессии

- [ ] Старт с дефолтным персонажем (если сейв есть) — без изменений
- [ ] Инвентарь, склад, дерево пассивок работают как раньше
- [ ] Сохранение/загрузка по K/L/Delete работают
