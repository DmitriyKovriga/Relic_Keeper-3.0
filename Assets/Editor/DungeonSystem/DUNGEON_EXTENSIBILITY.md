# Расширяемость системы данжей

Правила добавления компонентов, чтобы они корректно работали в данже.

---

## Правило 1: Расположение менеджеров

Все синглтоны и менеджеры должны находиться **в HubScene** на объектах, которые не скрываются при входе в данж (т.е. не внутри HubWorld).

---

## Правило 2: Не привязывайся к Hub-специфичным объектам

Если менеджер через `FindObjectOfType` или `[SerializeField]` ищет только объекты Hub (NPC, лавки и т.д.) — в данже они могут не найтись. Используй:
- интерфейсы (`IInteractable`, `IDamageable`),
- события,
- или проверку `if (obj != null)` перед использованием.

---

## Правило 3: Данные для комнат — в префабах

Данные уровня комнаты, спавнеров и порталов хранятся в **префабах комнат**. Не храни критичные данные в сцене Hub для объектов, которые будут уничтожены при смене комнаты.

---

## Правило 4: Чеклист при добавлении нового компонента

- [ ] Компонент живёт в Hub (не в комнате) или в префабе комнаты?
- [ ] Если в Hub — он не зависит от объектов, уничтожаемых при смене комнаты?
- [ ] Если в комнате — он получает RoomLevel через RoomController или родителя?
- [ ] Обновить `DUNGEON_SYSTEM_PLAN.md` или `DUNGEON_EXTENSIBILITY.md`, если добавляешь новый тип сущности.

---

## Чеклист сущностей (работают в данже)

| Сущность | Где живёт | В данже |
|----------|-----------|---------|
| Player | Hub | Работает, телепортируется |
| Main Camera | Hub | Следует за Player |
| InputManager | Hub | Работает |
| GameSaveManager | Hub | Работает |
| CharacterPartyManager | Hub | Работает |
| InventoryManager | Hub | Работает |
| StashManager | Hub | Работает |
| PoolManager | Hub | Работает |
| FloatingTextManager | Hub | Работает |
| ItemGenerator | Hub | Работает |
| WindowManager | Hub | Работает |
